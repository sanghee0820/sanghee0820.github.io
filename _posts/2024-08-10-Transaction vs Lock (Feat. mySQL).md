---
title: "Transaction vs Lock (Feat. mySQL)"
date: 2024-08-10
categories: [DB]
tags: [Database]
---
>이 글은 [velog](https://velog.io/@sanghee0820/Transaction-vs-Lock-Feat.-mySQL)에서 작성한 글입니다.

며칠 전, 어떤 분과 **Transactional**과 **Lock**에 대해 이야기할 기회가 있었는데, 스스로 명확하게 설명하 지 못해 아쉬워서 이 글을 통해 정리하려고 한다.


## Transaction
최근까지 나는 **Transactional**을 사용하면 동시성 제어가 모두 해결되는 줄 알았다(주변에 꽤 많은 사람들이 이렇게 생각하고 있는 것 같다). **하지만 실제로는 그렇지 않다!**

Transaction 자체를 설명하는 글은 아니지만, **간단히 Transaction에 대해** 먼저 알아보겠다.

### Transaction이 뭔데?

> **쪼갤 수 없는 최소 작업 단위**

트랜젝션은 **쪼갤 수 없는 최소 작업 단위**를 뜻한다.
조금 다르게 설명하면, **한번에 수행되어야할 일련의 작업 단위** 이다.

**"계좌이체" 란 트랜젝션** 내부에는, **"송금계좌 잔액 차감 & 입금계좌 잔액 증가"** 라는 세부 작업이 포함되어 있다.

### 특징
Transaction은 다음과 같은 특징을 가진다.

1. **A(Atomic)**
  - All or Nothing
  - 트랜젝션 내 작업이 모두 수행되거나, 전혀 수행되지 않는다.
2. **C(Consistency)**
  - 제약조건을 위반하지 않도록 해준다.
  - 이 부분이 와닿지 않았는데, Transaction 내에서 DB의 제약조건을 유지하도록 해준다 라고 받아들였다.
3. **I(Isolation)**
  - 동시에 여러 트랜잭션이 실행되더라도, 각 트랜잭션은 마치 자신만 데이터베이스를 사용하는 것처럼 작동해야 한다.
4. **D(Durability)**
  - 트랜잭션이 성공적으로 커밋되면 그 결과는 영구적으로 저장되어야 한다.

### Isolation Level

이 글에서 **Lock과 Transaction을 비교하기 위해서는 Isolation Level이 가장 중요**하다.

**READ UNCOMMITED**
> **다른 트렌젝션이 커밋되지 않아도 읽을 수 있다.**


**READ COMMITED**
> **다른 트랜잭션이 작업 중인(아직 커밋되지 않은) 데이터는 읽지 않으므로 더티 리드(Dirty Read)를 방지할 수 있다.**

**REPEATABLE READ**

> **REPEATABLE READ는 트랜잭션이 시작된 시점의 데이터를 기준으로 동일 트랜잭션 내에서 반복 읽기를 보장한다.**
이 격리 수준은 Non-repeatable Read 문제를 해결하지만, **팬텀 리드(Phantom Read)** 문제가 있다.

**SERIALIZABLE**

> **모든 트랜잭션이 순차적으로 실행되는 것처럼 동작하도록 보장한다.**
이로 인해 데이터의 일관성이 극대화되지만, 동시성이 크게 저하될 수 있어 성능상의 문제가 존재한다.


## Lock

이제 Lock(잠금)에 대해 살펴보자.

### Lock의 개념

**Lock은 데이터베이스 내에서 특정 데이터에 대한 접근 권한을 제어하는 메커니즘이다.**
이를 통해 **동시에 여러 트랜잭션이 동일한 데이터에 접근하여 충돌하거나 데이터 무결성이 깨지는 것을 방지**할 수 있다.

### Lock의 종류
**1. 공유 잠금(Shared Lock, S-Lock)**
* 읽기 작업을 수행할 때 사용된다.
* 여러 트랜잭션이 동일 데이터에 대해 공유 잠금을 동시에 걸 수 있어, 동시 읽기가 가능하다.

**2. 배타 잠금(Exclusive Lock, X-Lock)**
* 쓰기 작업이나 수정 작업 시 사용된다.
* 배타 잠금이 걸린 데이터는 다른 트랜잭션이 읽거나 쓸 수 없도록 하여, 데이터의 변경 충돌을 방지한다.

## Transaction vs Lock 마무리.

**트랜젝션과 락을 정리하면 다음과 같다.**

>
**Transaction**
- 일련의 작업 단위로, 작업이 모두 성공하거나 모두 실패해야 하는 원자성을 보장한다.
- **ACID 원칙(Atomicity, Consistency, Isolation, Durability)을 통해 데이터의 무결성을 유지**한다.
- 격리 수준 설정을 통해 동시성 제어의 정책적인 측면을 관리한다.

>
**Lock**
- **데이터에 대한 실제 접근 제어를 담당**하여, 동시에 여러 트랜잭션이 동일 데이터에 접근할 때 발생할 수 있는 충돌을 방지한다.
- Transaction 내부의 동시성 문제를 구체적인 메커니즘으로 해결한다.

**두 개념은 서로 보완적이다.**
Transaction은 데이터 **무결성과 작업의 원자성을 보장하기 위한 상위 개념**이고, Lock은 그 내부에서 데이터에 대한 **실제 접근을 제어**하여 충돌이나 데이터 불일치를 방지하는 역할을 한다.

이 글이 Transaction과 Lock에 대해 이해하는 데 도움이 되었기를 바란다.
